services:
  postgres:
    # Inherits from docker-compose.yml (port ${DEV_DB_PORT:-5433}, container ${POSTGRES_CONTAINER:-vacay-postgres-dev})
    # No overrides needed

  api:
    image: oven/bun:1.3
    container_name: ${API_CONTAINER:-vacay-api-dev}
    working_dir: /app
    depends_on:
      postgres:
        condition: service_healthy
    environment:
      PORT: ${API_PORT:-3000}
      NODE_ENV: ${NODE_ENV:-development}
      FRONTEND_URL: ${FRONTEND_URL:-http://localhost:5173}
      DATABASE_URL: postgresql://${POSTGRES_USER:-vacay}:${POSTGRES_PASSWORD:-vacay}@postgres:5432/${POSTGRES_DB:-vacay}
    volumes:
      - ./api:/app
      # Keep container node_modules isolated to avoid host conflicts/permissions
      - /app/node_modules
    command: >
      sh -c "bun install && bun run --hot src/index.ts"
    ports:
      - '${API_PORT:-3000}:3000'
